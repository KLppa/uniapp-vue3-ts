{"version":3,"file":"profile.js","sources":["../../../../../src/pagesMember/profile/profile.vue","../../../../../uniPage:/cGFnZXNNZW1iZXIvcHJvZmlsZS9wcm9maWxlLnZ1ZQ"],"sourcesContent":["<script setup lang=\"ts\">\nimport { getMemberProfileAPI, putMemberProflieAPI } from \"@/services/proflie\";\nimport { useMemberStore } from \"@/stores\";\nimport type { Gender, ProfileDetail } from \"@/types/member\";\nimport { onLoad } from \"@dcloudio/uni-app\";\nimport { ref } from \"vue\";\n\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync();\n\n// 获取个人信息, 修改个人信息需要提供初始值，这通过as来指定初始值对象\nconst profile = ref<ProfileDetail>({} as ProfileDetail);\nconst getMemberProfileData = async () => {\n  const res = await getMemberProfileAPI();\n  profile.value = res.result;\n  console.log(res);\n};\n\nconst memberStore = useMemberStore();\n\n// 修改头像\nconst onAvatarChange = () => {\n  // 调用拍照或者选择图片的API\n  uni.chooseMedia({\n    count: 1, // 文件个数\n    mediaType: [\"image\"], // 文件类型\n    success: (res) => {\n      const { tempFilePath } = res.tempFiles[0];\n      uni.uploadFile({\n        url: \"/member/profile/avatar\",\n        name: \"file\",\n        filePath: tempFilePath,\n        success: (res) => {\n          if (res.statusCode === 200) {\n            const avatar = JSON.parse(res.data).result.avatar;\n            // 个人信息页数据更新\n            profile.value!.avatar = avatar;\n            // 更新store中的头像\n            memberStore.profile!.avatar = avatar;\n            uni.showToast({\n              icon: \"success\",\n              title: \"上传头像成功\",\n            });\n          } else {\n            uni.showToast({\n              title: \"netWork find out problem, so Try again later pls\",\n              icon: \"success\",\n              mask: true,\n            });\n          }\n        },\n      });\n    },\n  });\n};\n\n// 点击保存提交表单\nconst onSubmit = async () => {\n  const [provinceCode, cityCode, countyCode] = fullLocationCode;\n  const res = await putMemberProflieAPI({\n    nickname: profile.value?.nickname,\n    gender: profile.value.gender,\n    birthday: profile.value.birthday,\n    profession: profile.value?.profession,\n    provinceCode,\n    cityCode,\n    countyCode,\n  });\n  // 更新store里面的数据\n  memberStore.profile!.nickname = res.result.nickname;\n\n  uni.showToast({\n    icon: \"success\",\n    title: \"保存成功\",\n  });\n\n  setTimeout(() => {\n    // 返回上一级，给用户良好的体验\n    uni.navigateBack();\n  }, 400);\n};\n\n// 修改性别\nconst onGenderChange: UniHelper.RadioGroupOnChange = (e) => {\n  profile.value.gender = e.detail.value as Gender;\n};\n\n// 修改生日\nconst onBirthdayChange: UniHelper.DatePickerOnChange = (e) => {\n  profile.value.birthday = e.detail.value;\n};\n\n// 修改城市\nlet fullLocationCode: [string, string, string] = [\"\", \"\", \"\"];\nconst onCityChange: UniHelper.RegionPickerOnChange = (e) => {\n  console.log(e.detail.value.join(\" \"));\n\n  // 修改前端界面\n  profile.value.fullLocation = e.detail.value.join(\" \");\n\n  // 提交后端更新用的\n  fullLocationCode = e.detail.code!;\n};\n\nonLoad(() => {\n  getMemberProfileData();\n});\n</script>\n\n<template>\n  <view class=\"viewport\">\n    <!-- 导航栏 -->\n    <view class=\"navbar\" :style=\"{ paddingTop: safeAreaInsets?.top + 'px' }\">\n      <navigator\n        open-type=\"navigateBack\"\n        class=\"back icon-left\"\n        hover-class=\"none\"\n      ></navigator>\n      <view class=\"title\">个人信息</view>\n    </view>\n\n    <!-- 头像 -->\n    <view class=\"avatar\">\n      <view class=\"avatar-content\" @tap=\"onAvatarChange\">\n        <image class=\"image\" :src=\"profile?.avatar\" mode=\"aspectFill\" />\n        <text class=\"text\">点击修改头像</text>\n      </view>\n    </view>\n\n    <!-- 表单 -->\n    <view class=\"form\">\n      <!-- 表单内容 -->\n      <view class=\"form-content\">\n        <view class=\"form-item\">\n          <text class=\"label\">账号</text>\n          <text class=\"account\">{{ profile?.account }}</text>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">昵称</text>\n          <input\n            class=\"input\"\n            type=\"text\"\n            placeholder=\"请填写昵称\"\n            v-model=\"profile!.nickname\"\n          />\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">性别</text>\n          <radio-group @change=\"onGenderChange\">\n            <label class=\"radio\">\n              <radio\n                value=\"男\"\n                color=\"#27ba9b\"\n                :checked=\"profile?.gender === '男'\"\n              />\n              男\n            </label>\n            <label class=\"radio\">\n              <radio\n                value=\"女\"\n                color=\"#27ba9b\"\n                :checked=\"profile?.gender === '女'\"\n              />\n              女\n            </label>\n          </radio-group>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">生日</text>\n          <picker\n            @change=\"onBirthdayChange\"\n            class=\"picker\"\n            mode=\"date\"\n            start=\"1900-01-01\"\n            :end=\"new Date()\"\n            :value=\"profile?.birthday\"\n          >\n            <view v-if=\"profile?.birthday\">{{ profile?.birthday }}</view>\n            <view class=\"placeholder\" v-else>请选择日期</view>\n          </picker>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">城市</text>\n          <picker\n            @change=\"onCityChange\"\n            class=\"picker\"\n            mode=\"region\"\n            :value=\"profile.fullLocation?.split(' ')\"\n          >\n            <view v-if=\"profile?.fullLocation\">{{ profile.fullLocation }}</view>\n            <view class=\"placeholder\" v-else>请选择城市</view>\n          </picker>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">职业</text>\n          <input\n            class=\"input\"\n            type=\"text\"\n            placeholder=\"请填写职业\"\n            v-model=\"profile!.profession\"\n          />\n        </view>\n      </view>\n      <!-- 提交按钮 -->\n      <button @tap=\"onSubmit\" class=\"form-button\">保 存</button>\n    </view>\n  </view>\n</template>\n\n<style lang=\"scss\">\npage {\n  background-color: #f4f4f4;\n}\n\n.viewport {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background-image: url(https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/order_bg.png);\n  background-size: auto 420rpx;\n  background-repeat: no-repeat;\n}\n\n// 导航栏\n.navbar {\n  position: relative;\n\n  .title {\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-size: 16px;\n    font-weight: 500;\n    color: #fff;\n  }\n\n  .back {\n    position: absolute;\n    height: 40px;\n    width: 40px;\n    left: 0;\n    font-size: 20px;\n    color: #fff;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n}\n\n// 头像\n.avatar {\n  text-align: center;\n  width: 100%;\n  height: 260rpx;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n\n  .image {\n    width: 160rpx;\n    height: 160rpx;\n    border-radius: 50%;\n    background-color: #eee;\n  }\n\n  .text {\n    display: block;\n    padding-top: 20rpx;\n    line-height: 1;\n    font-size: 26rpx;\n    color: #fff;\n  }\n}\n\n// 表单\n.form {\n  background-color: #f4f4f4;\n\n  &-content {\n    margin: 20rpx 20rpx 0;\n    padding: 0 20rpx;\n    border-radius: 10rpx;\n    background-color: #fff;\n  }\n\n  &-item {\n    display: flex;\n    height: 96rpx;\n    line-height: 46rpx;\n    padding: 25rpx 10rpx;\n    background-color: #fff;\n    font-size: 28rpx;\n    border-bottom: 1rpx solid #ddd;\n\n    &:last-child {\n      border: none;\n    }\n\n    .label {\n      width: 180rpx;\n      color: #333;\n    }\n\n    .account {\n      color: #666;\n    }\n\n    .input {\n      flex: 1;\n      display: block;\n      height: 46rpx;\n    }\n\n    .radio {\n      margin-right: 20rpx;\n    }\n\n    .picker {\n      flex: 1;\n    }\n    .placeholder {\n      color: #808080;\n    }\n  }\n\n  &-button {\n    height: 80rpx;\n    text-align: center;\n    line-height: 80rpx;\n    margin: 30rpx 20rpx;\n    color: #fff;\n    border-radius: 80rpx;\n    font-size: 30rpx;\n    background-color: #27ba9b;\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/ljh/Desktop/uniapp-v3+Ts-shop/src/pagesMember/profile/profile.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","getMemberProfileAPI","useMemberStore","res","putMemberProflieAPI","onLoad"],"mappings":";;;;;;;;;AAQA,UAAM,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAG3C,UAAA,UAAUC,kBAAmB,CAAA,CAAmB;AACtD,UAAM,uBAAuB,YAAY;AACjC,YAAA,MAAM,MAAMC,iBAAAA;AAClB,cAAQ,QAAQ,IAAI;AACpB,cAAQ,IAAI,GAAG;AAAA,IAAA;AAGjB,UAAM,cAAcC,sBAAAA;AAGpB,UAAM,iBAAiB,MAAM;AAE3BH,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA;AAAA,QACP,WAAW,CAAC,OAAO;AAAA;AAAA,QACnB,SAAS,CAAC,QAAQ;AAChB,gBAAM,EAAE,aAAiB,IAAA,IAAI,UAAU,CAAC;AACxCA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK;AAAA,YACL,MAAM;AAAA,YACN,UAAU;AAAA,YACV,SAAS,CAACI,SAAQ;AACZA,kBAAAA,KAAI,eAAe,KAAK;AAC1B,sBAAM,SAAS,KAAK,MAAMA,KAAI,IAAI,EAAE,OAAO;AAE3C,wBAAQ,MAAO,SAAS;AAExB,4BAAY,QAAS,SAAS;AAC9BJ,8BAAAA,MAAI,UAAU;AAAA,kBACZ,MAAM;AAAA,kBACN,OAAO;AAAA,gBAAA,CACR;AAAA,cAAA,OACI;AACLA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO;AAAA,kBACP,MAAM;AAAA,kBACN,MAAM;AAAA,gBAAA,CACP;AAAA,cACH;AAAA,YACF;AAAA,UAAA,CACD;AAAA,QACH;AAAA,MAAA,CACD;AAAA,IAAA;AAIH,UAAM,WAAW,YAAY;;AAC3B,YAAM,CAAC,cAAc,UAAU,UAAU,IAAI;AACvC,YAAA,MAAM,MAAMK,qCAAoB;AAAA,QACpC,WAAU,aAAQ,UAAR,mBAAe;AAAA,QACzB,QAAQ,QAAQ,MAAM;AAAA,QACtB,UAAU,QAAQ,MAAM;AAAA,QACxB,aAAY,aAAQ,UAAR,mBAAe;AAAA,QAC3B;AAAA,QACA;AAAA,QACA;AAAA,MAAA,CACD;AAEW,kBAAA,QAAS,WAAW,IAAI,OAAO;AAE3CL,oBAAAA,MAAI,UAAU;AAAA,QACZ,MAAM;AAAA,QACN,OAAO;AAAA,MAAA,CACR;AAED,iBAAW,MAAM;AAEfA,sBAAA,MAAI,aAAa;AAAA,SAChB,GAAG;AAAA,IAAA;AAIF,UAAA,iBAA+C,CAAC,MAAM;AAClD,cAAA,MAAM,SAAS,EAAE,OAAO;AAAA,IAAA;AAI5B,UAAA,mBAAiD,CAAC,MAAM;AACpD,cAAA,MAAM,WAAW,EAAE,OAAO;AAAA,IAAA;AAIpC,QAAI,mBAA6C,CAAC,IAAI,IAAI,EAAE;AACtD,UAAA,eAA+C,CAAC,MAAM;AAC1D,cAAQ,IAAI,EAAE,OAAO,MAAM,KAAK,GAAG,CAAC;AAGpC,cAAQ,MAAM,eAAe,EAAE,OAAO,MAAM,KAAK,GAAG;AAGpD,yBAAmB,EAAE,OAAO;AAAA,IAAA;AAG9BM,kBAAAA,OAAO,MAAM;AACU;IAAA,CACtB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzGD,GAAG,WAAW,eAAe;"}
{"version":3,"file":"address-form.js","sources":["../../../../../src/pagesMember/address-form/address-form.vue","../../../../../uniPage:/cGFnZXNNZW1iZXIvYWRkcmVzcy1mb3JtL2FkZHJlc3MtZm9ybS52dWU"],"sourcesContent":["<script setup lang=\"ts\">\nimport {\n  getMemberAddressByIdAPI,\n  postMemberAdressAPI,\n  putMemberAddressByIdAPI,\n} from \"@/services/address\";\nimport { onLoad } from \"@dcloudio/uni-app\";\n\nimport { ref } from \"vue\";\n\n// 存储表单实例\nconst formRef = ref<UniHelper.UniFormsInstance>();\n// 定义校验规则\nconst rules = {\n  // 收货人\n  receiver: {\n    rules: [\n      {\n        required: true,\n        errorMessage: \"请输入姓名\",\n      },\n      {\n        minLength: 3,\n        maxLength: 10,\n        errorMessage: \"请输入合适的长度\",\n      },\n    ],\n  },\n\n  // 手机号码\n  contact: {\n    rules: [\n      {\n        required: true,\n        errorMessage: \"请输入联系方式\",\n      },\n      {\n        pattern: /^1[3-9]\\d{9}$/,\n        errorMessage: \"手机号格式不正确\",\n      },\n    ],\n  },\n\n  // 所在地区\n  fullLocation: {\n    rules: [\n      {\n        required: true,\n        errorMessage: \"请选择所在地区\",\n      },\n    ],\n  },\n\n  // 详细地址\n  address: {\n    rules: [\n      {\n        required: true,\n        errorMessage: \"请选择详细地址\",\n      },\n    ],\n  },\n};\n\n// 表单数据\nconst form = ref({\n  receiver: \"\", // 收货人\n  contact: \"\", // 联系方式\n  fullLocation: \"\", // 省市区(前端展示)\n  provinceCode: \"\", // 省份编码(后端参数)\n  cityCode: \"\", // 城市编码(后端参数)\n  countyCode: \"\", // 区/县编码(后端参数)\n  address: \"\", // 详细地址\n  isDefault: 0, // 默认地址，1为是，0为否\n});\n\n// 获取页面参数\nconst query = defineProps<{\n  id?: string;\n}>();\n\n// 动态设置标题\nuni.setNavigationBarTitle({ title: query.id ? \"修改地址\" : \"新建地址\" });\n\n// 收集所在地区的事件处理函数\nconst onRegionChange: UniHelper.RegionPickerOnChange = (e) => {\n  // 省市区用于前端展示\n  form.value.fullLocation = e.detail.value.join(\" \");\n\n  // 后端参数处理，code\n  const [provinceCode, cityCode, countyCode] = e.detail.code!;\n\n  // 合并\n  Object.assign(form.value, { provinceCode, cityCode, countyCode });\n};\n\n// 收集是否，设为默认地址\nconst onSwitchChange: UniHelper.SwitchOnChange = (e) => {\n  form.value.isDefault = e.detail.value ? 1 : 0;\n};\n\n// 提交表单\nconst onSubmit = async () => {\n  try {\n    await formRef.value?.validate?.();\n    if (query.id) await putMemberAddressByIdAPI(query.id, form.value);\n    else await postMemberAdressAPI(form.value);\n\n    uni.showToast({\n      icon: \"success\",\n      title: query.id ? \"修改地址成功!\" : \"添加地址成功!\",\n    });\n\n    setTimeout(() => {\n      uni.navigateBack();\n    }, 400);\n  } catch (error) {\n    uni.showToast({ icon: \"error\", title: \"请填写完整信息\" });\n  }\n};\n\n// 获取收货地址详情数据\nconst getMemberAddressByIdData = async () => {\n  if (query.id) {\n    const res = await getMemberAddressByIdAPI(query.id);\n    // 将数据合并到form.value中\n    Object.assign(form.value, res.result);\n  }\n};\n\n// 页面加载时\nonLoad(() => {\n  getMemberAddressByIdData();\n});\n</script>\n\n<template>\n  <view class=\"content\">\n    <uni-forms :rules=\"rules\" :model=\"form\" ref=\"formRef\">\n      <!-- 表单内容 -->\n      <uni-forms-item name=\"receiver\" class=\"form-item\">\n        <text class=\"label\">收货人</text>\n        <input\n          class=\"input\"\n          placeholder=\"请填写收货人姓名\"\n          v-model=\"form.receiver\"\n        />\n      </uni-forms-item>\n\n      <uni-forms-item name=\"contact\" class=\"form-item\">\n        <text class=\"label\">手机号码</text>\n        <input\n          class=\"input\"\n          placeholder=\"请填写收货人手机号码\"\n          v-model=\"form.contact\"\n        />\n      </uni-forms-item>\n\n      <uni-forms-item name=\"fullLocation\" class=\"form-item\">\n        <text class=\"label\">所在地区</text>\n        <picker\n          @change=\"onRegionChange\"\n          class=\"picker\"\n          mode=\"region\"\n          :value=\"form.fullLocation.split(' ')\"\n        >\n          <view v-if=\"form.fullLocation\">{{ form.fullLocation }}</view>\n          <view v-else class=\"placeholder\">请选择省/市/区(县)</view>\n        </picker>\n      </uni-forms-item>\n\n      <uni-forms-item name=\"address\" class=\"form-item\">\n        <text class=\"label\">详细地址</text>\n        <input\n          class=\"input\"\n          placeholder=\"街道、楼牌号等信息\"\n          v-model=\"form.address\"\n        />\n      </uni-forms-item>\n\n      <uni-forms-item class=\"form-item\">\n        <label class=\"label\">设为默认地址</label>\n        <switch\n          @change=\"onSwitchChange\"\n          class=\"switch\"\n          color=\"#27ba9b\"\n          :checked=\"form.isDefault === 1\"\n        />\n      </uni-forms-item>\n    </uni-forms>\n  </view>\n  <!-- 提交按钮 -->\n  <button @tap=\"onSubmit\" class=\"button\">保存并使用</button>\n  {{ form }}\n</template>\n\n<style lang=\"scss\">\npage {\n  background-color: #f4f4f4;\n}\n\n.content {\n  margin: 20rpx 20rpx 0;\n  padding: 0 20rpx;\n  border-radius: 10rpx;\n  background-color: #fff;\n\n  .form-item,\n  .uni-forms-item {\n    display: flex;\n    align-items: center;\n    min-height: 96rpx;\n    padding: 25rpx 10rpx 40rpx;\n    background-color: #fff;\n    font-size: 28rpx;\n    border-bottom: 1rpx solid #ddd;\n    position: relative;\n    margin-bottom: 0;\n\n    // 调整 uni-forms 样式\n    .uni-forms-item__content {\n      display: flex;\n    }\n\n    .uni-forms-item__error {\n      margin-left: 200rpx;\n    }\n\n    &:last-child {\n      border: none;\n    }\n\n    .label {\n      width: 200rpx;\n      color: #333;\n    }\n\n    .input {\n      flex: 1;\n      display: block;\n      height: 46rpx;\n    }\n\n    .switch {\n      position: absolute;\n      right: -20rpx;\n      transform: scale(0.8);\n    }\n\n    .picker {\n      flex: 1;\n    }\n\n    .placeholder {\n      color: #808080;\n    }\n  }\n}\n\n.button {\n  height: 80rpx;\n  margin: 30rpx 20rpx;\n  color: #fff;\n  border-radius: 80rpx;\n  font-size: 30rpx;\n  background-color: #27ba9b;\n}\n</style>\n","import MiniProgramPage from '/Users/ljh/Desktop/uniapp-v3+Ts-shop/src/pagesMember/address-form/address-form.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","putMemberAddressByIdAPI","postMemberAdressAPI","getMemberAddressByIdAPI","onLoad"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAWA,UAAM,UAAUA,cAAAA;AAEhB,UAAM,QAAQ;AAAA;AAAA,MAEZ,UAAU;AAAA,QACR,OAAO;AAAA,UACL;AAAA,YACE,UAAU;AAAA,YACV,cAAc;AAAA,UAChB;AAAA,UACA;AAAA,YACE,WAAW;AAAA,YACX,WAAW;AAAA,YACX,cAAc;AAAA,UAChB;AAAA,QACF;AAAA,MACF;AAAA;AAAA,MAGA,SAAS;AAAA,QACP,OAAO;AAAA,UACL;AAAA,YACE,UAAU;AAAA,YACV,cAAc;AAAA,UAChB;AAAA,UACA;AAAA,YACE,SAAS;AAAA,YACT,cAAc;AAAA,UAChB;AAAA,QACF;AAAA,MACF;AAAA;AAAA,MAGA,cAAc;AAAA,QACZ,OAAO;AAAA,UACL;AAAA,YACE,UAAU;AAAA,YACV,cAAc;AAAA,UAChB;AAAA,QACF;AAAA,MACF;AAAA;AAAA,MAGA,SAAS;AAAA,QACP,OAAO;AAAA,UACL;AAAA,YACE,UAAU;AAAA,YACV,cAAc;AAAA,UAChB;AAAA,QACF;AAAA,MACF;AAAA,IAAA;AAIF,UAAM,OAAOA,cAAAA,IAAI;AAAA,MACf,UAAU;AAAA;AAAA,MACV,SAAS;AAAA;AAAA,MACT,cAAc;AAAA;AAAA,MACd,cAAc;AAAA;AAAA,MACd,UAAU;AAAA;AAAA,MACV,YAAY;AAAA;AAAA,MACZ,SAAS;AAAA;AAAA,MACT,WAAW;AAAA;AAAA,IAAA,CACZ;AAQDC,wBAAI,sBAAsB,EAAE,OAAO,MAAM,KAAK,SAAS,QAAQ;AAGzD,UAAA,iBAAiD,CAAC,MAAM;AAE5D,WAAK,MAAM,eAAe,EAAE,OAAO,MAAM,KAAK,GAAG;AAGjD,YAAM,CAAC,cAAc,UAAU,UAAU,IAAI,EAAE,OAAO;AAGtD,aAAO,OAAO,KAAK,OAAO,EAAE,cAAc,UAAU,YAAY;AAAA,IAAA;AAI5D,UAAA,iBAA2C,CAAC,MAAM;AACtD,WAAK,MAAM,YAAY,EAAE,OAAO,QAAQ,IAAI;AAAA,IAAA;AAI9C,UAAM,WAAW,YAAY;;AACvB,UAAA;AACI,gBAAA,mBAAQ,UAAR,mBAAe,aAAf;AACN,YAAI,MAAM;AAAI,gBAAMC,iBAAwB,wBAAA,MAAM,IAAI,KAAK,KAAK;AAAA;AACrD,gBAAAC,iBAAA,oBAAoB,KAAK,KAAK;AAEzCF,sBAAAA,MAAI,UAAU;AAAA,UACZ,MAAM;AAAA,UACN,OAAO,MAAM,KAAK,YAAY;AAAA,QAAA,CAC/B;AAED,mBAAW,MAAM;AACfA,wBAAA,MAAI,aAAa;AAAA,WAChB,GAAG;AAAA,eACC,OAAO;AACdA,sBAAA,MAAI,UAAU,EAAE,MAAM,SAAS,OAAO,WAAW;AAAA,MACnD;AAAA,IAAA;AAIF,UAAM,2BAA2B,YAAY;AAC3C,UAAI,MAAM,IAAI;AACZ,cAAM,MAAM,MAAMG,iBAAAA,wBAAwB,MAAM,EAAE;AAElD,eAAO,OAAO,KAAK,OAAO,IAAI,MAAM;AAAA,MACtC;AAAA,IAAA;AAIFC,kBAAAA,OAAO,MAAM;AACc;IAAA,CAC1B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpID,GAAG,WAAW,eAAe;"}
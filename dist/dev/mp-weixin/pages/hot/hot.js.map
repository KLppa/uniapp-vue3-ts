{"version":3,"file":"hot.js","sources":["../../../../../src/pages/hot/hot.vue","../../../../../uniPage:/cGFnZXMvaG90L2hvdC52dWU"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref } from \"vue\";\nimport { getHotRecommendAPI } from \"@/services/hot\";\nimport { onLoad } from \"@dcloudio/uni-app\";\nimport type { subTypeItem } from \"@/types/hot\";\n\n// 高亮的下标\nconst activeIndex = ref(0);\n\n// 推荐封面图\nconst bannerPicture = ref(\"\");\nconst subTypes = ref<(subTypeItem & { finish?: boolean })[]>([]);\n// 热门推荐页 标题和url\nconst hotMap = [\n  { type: \"1\", title: \"特惠推荐\", url: \"/hot/preference\" },\n  { type: \"2\", title: \"爆款推荐\", url: \"/hot/inVogue\" },\n  { type: \"3\", title: \"一站买全\", url: \"/hot/oneStop\" },\n  { type: \"4\", title: \"新鲜好物\", url: \"/hot/new\" },\n];\n\n// uniapp 获取页面参数,这种事页面传参，不是父子组件之间相互传参\nconst query = defineProps<{ type: string }>();\nconst currUrlMap = hotMap.find((v) => v.type === query.type);\n// 动态设置标题\nuni.setNavigationBarTitle({\n  // 利用非空断言排除掉undefined的情况\n  title: currUrlMap!.title,\n});\n\n// 获取热门推荐数据\nconst getHotRecommendData = async () => {\n  const res = await getHotRecommendAPI(currUrlMap!.url, {\n    // 技巧，环境变量，开发环境，修改初始化页面方便测试分页结束\n    page: import.meta.env.DEV ? 30 : 1,\n    pageSize: 10,\n  });\n  bannerPicture.value = res.result.bannerPicture;\n  subTypes.value = res.result.subTypes;\n};\n\n// 滚动触底\nconst onScrolltolower = async () => {\n  // 获取当前选项\n  const currsubTypes = subTypes.value[activeIndex.value];\n\n  // 分页条件\n  if (currsubTypes.goodsItems.page < currsubTypes.goodsItems.pages) {\n    // 当前页码累加\n    (currsubTypes.goodsItems.page as number)++;\n  } else {\n    currsubTypes.finish = true;\n    // 标记已经结束\n    return uni.showToast({ icon: \"none\", title: \"没有更多数据啦\" });\n  }\n\n  // 调用API传参\n  const res = await getHotRecommendAPI(currUrlMap!.url, {\n    subType: currsubTypes.id,\n    page: currsubTypes.goodsItems.page as number,\n    pageSize: currsubTypes.goodsItems.pageSize as number,\n  });\n\n  // 新的列表选项\n  const newsubTypes = res.result.subTypes[activeIndex.value];\n\n  // 数组追加\n  currsubTypes.goodsItems.items.push(...newsubTypes.goodsItems.items);\n};\n\n// 页面加载\nonLoad(() => {\n  getHotRecommendData();\n});\n</script>\n\n<template>\n  <view class=\"viewport\">\n    <!-- 推荐封面图 -->\n    <view class=\"cover\">\n      <image :src=\"bannerPicture\"></image>\n    </view>\n    <!-- 推荐选项 -->\n    <view class=\"tabs\">\n      <text\n        v-for=\"(item, index) in subTypes\"\n        :key=\"item.id\"\n        class=\"text\"\n        :class=\"{ active: index === activeIndex }\"\n        @tap=\"activeIndex = index\"\n        >{{ item.title }}</text\n      >\n    </view>\n    <!-- 推荐列表 -->\n    <scroll-view\n      v-for=\"(item, index) in subTypes\"\n      :key=\"item.id\"\n      scroll-y\n      class=\"scroll-view\"\n      v-show=\"activeIndex === index\"\n      @scrolltolower=\"onScrolltolower\"\n    >\n      <view class=\"goods\">\n        <navigator\n          hover-class=\"none\"\n          class=\"navigator\"\n          v-for=\"goods in item.goodsItems.items\"\n          :key=\"goods.id\"\n          :url=\"`/pages/goods/goods?id=${goods.id}`\"\n        >\n          <image class=\"thumb\" :src=\"goods.picture\"></image>\n          <view class=\"name ellipsis\">{{ goods.name }}</view>\n          <view class=\"price\">\n            <text class=\"symbol\">¥</text>\n            <text class=\"number\">{{ goods.price }}</text>\n          </view>\n        </navigator>\n      </view>\n\n      <view class=\"loading-text\">{{\n        item.finish ? \"没有更多数据啦\" : \"正在加载...\"\n      }}</view>\n    </scroll-view>\n  </view>\n</template>\n\n<style lang=\"scss\">\npage {\n  height: 100%;\n  background-color: #f4f4f4;\n}\n.viewport {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  padding: 180rpx 0 0;\n  position: relative;\n}\n.cover {\n  width: 750rpx;\n  height: 225rpx;\n  border-radius: 0 0 40rpx 40rpx;\n  overflow: hidden;\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n.scroll-view {\n  flex: 1;\n}\n.tabs {\n  display: flex;\n  justify-content: space-evenly;\n  height: 100rpx;\n  line-height: 90rpx;\n  margin: 0 20rpx;\n  font-size: 28rpx;\n  border-radius: 10rpx;\n  box-shadow: 0 4rpx 5rpx rgba(200, 200, 200, 0.3);\n  color: #333;\n  background-color: #fff;\n  position: relative;\n  z-index: 9;\n  .text {\n    margin: 0 20rpx;\n    position: relative;\n  }\n  .active {\n    &::after {\n      content: \"\";\n      width: 40rpx;\n      height: 4rpx;\n      transform: translate(-50%);\n      background-color: #27ba9b;\n      position: absolute;\n      left: 50%;\n      bottom: 24rpx;\n    }\n  }\n}\n.goods {\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n  padding: 0 20rpx 20rpx;\n  .navigator {\n    width: 345rpx;\n    padding: 20rpx;\n    margin-top: 20rpx;\n    border-radius: 10rpx;\n    background-color: #fff;\n  }\n  .thumb {\n    width: 305rpx;\n    height: 305rpx;\n  }\n  .name {\n    height: 88rpx;\n    font-size: 26rpx;\n  }\n  .price {\n    line-height: 1;\n    color: #cf4444;\n    font-size: 30rpx;\n  }\n  .symbol {\n    font-size: 70%;\n  }\n  .decimal {\n    font-size: 70%;\n  }\n}\n\n.loading-text {\n  text-align: center;\n  font-size: 28rpx;\n  color: #666;\n  padding: 20rpx 0 50rpx;\n}\n</style>\n","import MiniProgramPage from '/Users/ljh/Desktop/uniapp-v3+Ts-shop/src/pages/hot/hot.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","getHotRecommendAPI","onLoad"],"mappings":";;;;;;;;;;;;;AAOM,UAAA,cAAcA,kBAAI,CAAC;AAGnB,UAAA,gBAAgBA,kBAAI,EAAE;AACtB,UAAA,WAAWA,kBAA4C,CAAA,CAAE;AAE/D,UAAM,SAAS;AAAA,MACb,EAAE,MAAM,KAAK,OAAO,QAAQ,KAAK,kBAAkB;AAAA,MACnD,EAAE,MAAM,KAAK,OAAO,QAAQ,KAAK,eAAe;AAAA,MAChD,EAAE,MAAM,KAAK,OAAO,QAAQ,KAAK,eAAe;AAAA,MAChD,EAAE,MAAM,KAAK,OAAO,QAAQ,KAAK,WAAW;AAAA,IAAA;AAKxC,UAAA,aAAa,OAAO,KAAK,CAAC,MAAM,EAAE,SAAS,MAAM,IAAI;AAE3DC,kBAAAA,MAAI,sBAAsB;AAAA;AAAA,MAExB,OAAO,WAAY;AAAA,IAAA,CACpB;AAGD,UAAM,sBAAsB,YAAY;AACtC,YAAM,MAAM,MAAMC,gCAAmB,WAAY,KAAK;AAAA;AAAA,QAEpD,MAA4B;AAAA,QAC5B,UAAU;AAAA,MAAA,CACX;AACa,oBAAA,QAAQ,IAAI,OAAO;AACxB,eAAA,QAAQ,IAAI,OAAO;AAAA,IAAA;AAI9B,UAAM,kBAAkB,YAAY;AAElC,YAAM,eAAe,SAAS,MAAM,YAAY,KAAK;AAGrD,UAAI,aAAa,WAAW,OAAO,aAAa,WAAW,OAAO;AAE/D,qBAAa,WAAW;AAAA,MAAA,OACpB;AACL,qBAAa,SAAS;AAEtB,eAAOD,cAAAA,MAAI,UAAU,EAAE,MAAM,QAAQ,OAAO,WAAW;AAAA,MACzD;AAGA,YAAM,MAAM,MAAMC,gCAAmB,WAAY,KAAK;AAAA,QACpD,SAAS,aAAa;AAAA,QACtB,MAAM,aAAa,WAAW;AAAA,QAC9B,UAAU,aAAa,WAAW;AAAA,MAAA,CACnC;AAGD,YAAM,cAAc,IAAI,OAAO,SAAS,YAAY,KAAK;AAGzD,mBAAa,WAAW,MAAM,KAAK,GAAG,YAAY,WAAW,KAAK;AAAA,IAAA;AAIpEC,kBAAAA,OAAO,MAAM;AACS;IAAA,CACrB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvED,GAAG,WAAW,eAAe;"}